var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.default=ColorPicker;var _slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));var _react=_interopRequireWildcard(require("react"));var _reactNative=require("react-native");var _reactNativeGestureHandler=require("react-native-gesture-handler");var _reactNativeReanimated=require("react-native-reanimated");var _ColorsConversionFormulas=require("./ColorsConversionFormulas");var _GlobalStyles=require("./GlobalStyles");var _jsxFileName="D:\\Development\\--- Packages ---\\reanimated-color-picker\\lib\\ColorPicker.js";function _getRequireWildcardCache(nodeInterop){if(typeof WeakMap!=="function")return null;var cacheBabelInterop=new WeakMap();var cacheNodeInterop=new WeakMap();return(_getRequireWildcardCache=function _getRequireWildcardCache(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop;})(nodeInterop);}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule){return obj;}if(obj===null||typeof obj!=="object"&&typeof obj!=="function"){return{default:obj};}var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj)){return cache.get(obj);}var newObj={};var hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj){if(key!=="default"&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;if(desc&&(desc.get||desc.set)){Object.defineProperty(newObj,key,desc);}else{newObj[key]=obj[key];}}}newObj.default=obj;if(cache){cache.set(obj,newObj);}return newObj;}var CONTRAST_RATIO_MIN=4.5;function ColorPicker(_ref){var _ref$sliderThickness=_ref.sliderThickness,sliderThickness=_ref$sliderThickness===void 0?25:_ref$sliderThickness,_ref$thumbSize=_ref.thumbSize,thumbSize=_ref$thumbSize===void 0?35:_ref$thumbSize,_ref$thumbShape=_ref.thumbShape,thumbShape=_ref$thumbShape===void 0?'ring':_ref$thumbShape,_ref$value=_ref.value,value=_ref$value===void 0?'#418181':_ref$value,onChange=_ref.onChange,onComplete=_ref.onComplete,_ref$style=_ref.style,style=_ref$style===void 0?{}:_ref$style,_ref$children=_ref.children,children=_ref$children===void 0?_react.default.createElement(_reactNative.Text,{__self:this,__source:{fileName:_jsxFileName,lineNumber:8,columnNumber:162}},"NO CHILDREN"):_ref$children;var isFirstRender=(0,_react.useRef)(true);var initialColor=(0,_react.useRef)((0,_ColorsConversionFormulas.COLOR_HSVA)(value));var hue=(0,_react.useRef)(initialColor.current.h);var saturation=(0,_react.useRef)(initialColor.current.s);var brightness=(0,_react.useRef)(initialColor.current.b);var alpha=(0,_react.useRef)(initialColor.current.a);var colorHash=(0,_reactNativeReanimated.useSharedValue)(hue.current+","+saturation.current+","+brightness.current+","+alpha.current);var registeredHandles=(0,_react.useRef)([]);var color_hex=function color_hex(){return(0,_ColorsConversionFormulas.HEX_FORMAT)({h:hue.current,s:saturation.current,b:brightness.current,a:alpha.current});};var returnedResults=function returnedResults(){var color=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{h:hue.current,s:saturation.current,b:brightness.current,a:alpha.current};return{hex:(0,_ColorsConversionFormulas.HEX_FORMAT)(color),rgb:(0,_ColorsConversionFormulas.RGB_FORMAT)(color),rgba:(0,_ColorsConversionFormulas.RGBA_FORMAT)(color),hsl:(0,_ColorsConversionFormulas.HSL_FORMAT)(color),hsla:(0,_ColorsConversionFormulas.HSLA_FORMAT)(color),hsv:(0,_ColorsConversionFormulas.HSV_FORMAT)(color),hsva:(0,_ColorsConversionFormulas.HSVA_FORMAT)(color)};};var previewColor=(0,_reactNativeReanimated.useSharedValue)(color_hex());var previewColorStyle=(0,_reactNativeReanimated.useAnimatedStyle)(function(){var _f=function _f(){return{backgroundColor:previewColor.value};};_f._closure={previewColor:previewColor};_f.asString="function _f(){const{previewColor}=jsThis._closure;{return{backgroundColor:previewColor.value};}}";_f.__workletHash=9056204683932;_f.__location="D:\\Development\\--- Packages ---\\reanimated-color-picker\\lib\\ColorPicker.js (43:47)";_f.__optimalization=3;return _f;}());var solidColor=(0,_reactNativeReanimated.useAnimatedStyle)(function(){var _f=function _f(){return{backgroundColor:previewColor.value.length>7?previewColor.value.substring(0,7):previewColor.value};};_f._closure={previewColor:previewColor};_f.asString="function _f(){const{previewColor}=jsThis._closure;{return{backgroundColor:previewColor.value.length>7?previewColor.value.substring(0,7):previewColor.value};}}";_f.__workletHash=14945317885047;_f.__location="D:\\Development\\--- Packages ---\\reanimated-color-picker\\lib\\ColorPicker.js (45:40)";_f.__optimalization=2;return _f;}());var activeHue=(0,_reactNativeReanimated.useSharedValue)((0,_ColorsConversionFormulas.HSL_HEX)(hue.current,100,50));var activeHueStyle=(0,_reactNativeReanimated.useAnimatedStyle)(function(){var _f=function _f(){return{backgroundColor:activeHue.value};};_f._closure={activeHue:activeHue};_f.asString="function _f(){const{activeHue}=jsThis._closure;{return{backgroundColor:activeHue.value};}}";_f.__workletHash=650278191484;_f.__location="D:\\Development\\--- Packages ---\\reanimated-color-picker\\lib\\ColorPicker.js (50:44)";_f.__optimalization=3;return _f;}());var invertedColor=(0,_reactNativeReanimated.useSharedValue)('#ffffff');var invertedColorHue=(0,_reactNativeReanimated.useSharedValue)('#ffffff');var invertedColorBrightness=(0,_reactNativeReanimated.useSharedValue)('#ffffff');var invertedColorSaturation=(0,_reactNativeReanimated.useSharedValue)('#ffffff');var invertedColorOpacity=(0,_reactNativeReanimated.useSharedValue)('#ffffff');var onGestureEventFinish=function onGestureEventFinish(){onComplete==null?void 0:onComplete(returnedResults());};var setInvertedColor=function setInvertedColor(){setInverted({},invertedColor);setInverted({s:100,b:100},invertedColorHue);setInverted({s:100},invertedColorBrightness);setInverted({b:70},invertedColorSaturation);setInverted({s:alpha.current,b:70},invertedColorOpacity);};var setInverted=function setInverted(_ref2,color2){var _ref2$h=_ref2.h,h=_ref2$h===void 0?hue.current:_ref2$h,_ref2$s=_ref2.s,s=_ref2$s===void 0?saturation.current:_ref2$s,_ref2$b=_ref2.b,b=_ref2$b===void 0?brightness.current:_ref2$b;var inverted=color2.value==='#ffffff'?'#000000':'#ffffff';var contrast=(0,_ColorsConversionFormulas.CONTRAST_RATIO)({h:h,s:s,b:b},color2.value);color2.value=contrast<CONTRAST_RATIO_MIN?inverted:color2.value;};var updateBrightness=function updateBrightness(brightnessChannel){brightness.current=brightnessChannel;previewColor.value=color_hex();colorHash.value=hue.current+","+saturation.current+","+brightness.current+","+alpha.current;setInvertedColor();var brightnessHandles=registeredHandles.current.filter(function(setting){return setting.channel==='b';});applySettings(brightnessHandles,false);onChange==null?void 0:onChange(returnedResults());};var updateSaturation=function updateSaturation(saturationChannel){saturation.current=saturationChannel;previewColor.value=color_hex();colorHash.value=hue.current+","+saturation.current+","+brightness.current+","+alpha.current;setInvertedColor();var saturationHandles=registeredHandles.current.filter(function(setting){return setting.channel==='s';});applySettings(saturationHandles,false);onChange==null?void 0:onChange(returnedResults());};var updateHue=function updateHue(hueChannel){hue.current=hueChannel;previewColor.value=color_hex();colorHash.value=hue.current+","+saturation.current+","+brightness.current+","+alpha.current;setInvertedColor();activeHue.value=(0,_ColorsConversionFormulas.HSL_HEX)(hueChannel,100,50);var hueHandles=registeredHandles.current.filter(function(setting){return setting.channel==='h';});applySettings(hueHandles,false);onChange==null?void 0:onChange(returnedResults());};var updateOpacity=function updateOpacity(alphaChannel){alpha.current=alphaChannel;previewColor.value=color_hex();colorHash.value=hue.current+","+saturation.current+","+brightness.current+","+alpha.current;setInvertedColor();var opacityHandles=registeredHandles.current.filter(function(setting){return setting.channel==='a';});applySettings(opacityHandles,false);onChange==null?void 0:onChange(returnedResults());};var applySettings=function applySettings(){var settings=arguments.length>0&&arguments[0]!==undefined?arguments[0]:registeredHandles.current;var withAnimation=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var duration=150;var color={h:hue.current,s:saturation.current,b:brightness.current,a:alpha.current};for(var i=0;i<settings.length;i++){var _settings$i=settings[i],isReversed=_settings$i.isReversed,width=_settings$i.width,height=_settings$i.height,axis=_settings$i.axis,channel=_settings$i.channel,handle=_settings$i.handle,handleSize=_settings$i.thumbSize;var channelMax=channel==='h'?360:100;var length=axis==='y'?height:width;var percent=color[channel]/channelMax*length;if(axis==='angle'){var _handle=(0,_slicedToArray2.default)(handle,2),handleX=_handle[0],handleY=_handle[1];var center=width/2;var distance=color.s/100*(width/2);var posX=width-Math.round(Math.cos(color.h*Math.PI/180)*distance+center)-handleSize/2;var posY=width-Math.round(Math.sin(color.h*Math.PI/180)*distance+center)-handleSize/2;handleX.value=withAnimation?(0,_reactNativeReanimated.withTiming)(posX,{duration:duration}):posX;handleY.value=withAnimation?(0,_reactNativeReanimated.withTiming)(posY,{duration:duration}):posY;}var pos=(isReversed?length-percent:percent)-thumbSize/2;handle.value=withAnimation?(0,_reactNativeReanimated.withTiming)(pos,{duration:duration}):pos;}};var registerHandle=function registerHandle(settings){var currentSettings=registeredHandles.current;var index=registeredHandles.current.findIndex(function(current){return current.id&&current.id===settings.id;});if(index!==-1){currentSettings[index]=settings;registeredHandles.current=currentSettings;applySettings([settings]);return;}registeredHandles.current.push(settings);};var setColor=function setColor(color){var _COLOR_HSVA=(0,_ColorsConversionFormulas.COLOR_HSVA)(color),h=_COLOR_HSVA.h,s=_COLOR_HSVA.s,b=_COLOR_HSVA.b,a=_COLOR_HSVA.a;hue.current=h;saturation.current=s;brightness.current=b;alpha.current=a;colorHash.value=hue.current+","+saturation.current+","+brightness.current+","+alpha.current;previewColor.value=color_hex();activeHue.value=(0,_ColorsConversionFormulas.HSL_HEX)(h,100,50);setInvertedColor();applySettings();};(0,_react.useEffect)(function(){if(isFirstRender.current){isFirstRender.current=false;setInvertedColor();return;}initialColor.current=(0,_ColorsConversionFormulas.COLOR_HSVA)(value);setColor(value);},[value]);var ctxValue={activeHueStyle:activeHueStyle,invertedColor:invertedColor,invertedColorHue:invertedColorHue,invertedColorBrightness:invertedColorBrightness,invertedColorSaturation:invertedColorSaturation,invertedColorOpacity:invertedColorOpacity,previewColorStyle:previewColorStyle,solidColor:solidColor,colorHash:colorHash,setColor:setColor,updateSaturation:updateSaturation,updateBrightness:updateBrightness,updateOpacity:updateOpacity,updateHue:updateHue,sliderThickness:sliderThickness,thumbSize:thumbSize,thumbShape:thumbShape,initialColor:initialColor,value:value,returnedResults:returnedResults,registerHandle:registerHandle,onGestureEventFinish:onGestureEventFinish,onChange:onChange};return _react.default.createElement(_reactNativeGestureHandler.GestureHandlerRootView,{style:[styles.wrapper,style],__self:this,__source:{fileName:_jsxFileName,lineNumber:212,columnNumber:13}},_react.default.createElement(_GlobalStyles.CTX.Provider,{value:ctxValue,__self:this,__source:{fileName:_jsxFileName,lineNumber:213,columnNumber:7}},children));}var styles=_reactNative.StyleSheet.create({wrapper:{flexDirection:'column',justifyContent:'space-evenly',alignSelf:'center',flex:1}});